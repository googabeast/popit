function t(t,e){this.defaults={aria:!0,cache:!0,delay:0,cssClass:"",modalX:!0,expose:!0,exposeClose:!0,rxMatch:/@{(.*?)\}/},null===t?(this.defaults.name=e.defaults.name,this.opts=$.extend({},this.defaults,e.opts)):(this.$el=$(t),this.defaults.name=this.$el.attr("data-popit"),this.opts=$.extend({},this.defaults,$(t).data().info,{_linkswitch:$(t).data().linkswitch},e))}var e={timeout:1800,jsload:function(t){var e=this;$.get(t.url,function(e){$.templates("tmpl",e);var o=$.render.tmpl(t.data);t.append?t.target.append(o):t.target.html(o)}).done(function(o){void 0!==t.run&&e.isFunc(t.run)&&t.run(o),void 0!==t.callback&&e.isFunc(t.callback)&&t.callback(o)})},detect:function(t,e){var o=$(t),i={};return $.each(e,function(t,e){o.find(e.sel).length>0&&(i={name:e.name,$el:o.find(e.sel)}),o.filter(e.sel).length>0&&(i={name:e.name,$el:o.filter(e.sel)})}),i},waitForIt:function(t,e){var o=this,i=["/ajax/directIgnore.html"];void 0!==t&&"page"!==t||(t=$("body")),t.get(0)!==$("body").get(0)&&t.css({position:"relative"}),$(document).ajaxSend(function(e,o,a){function s(){for(var t=["testIgnore"],e=0;e<t.length;e++)if(a.url.indexOf(t[e])>-1)return!0}$(".waitForIt").length<=0&&i.indexOf(a.url)<=0&&(s()||t.append("<div class='waitForIt' />"))}),$(document).ajaxStop(function(){setTimeout(function(){$.waitForIt.close(),$("#addItem").removeAttr("disabled").removeAttr("style")},1e3)}),o.isFunc(e)&&e()},checkApiEvents:function(t){var e=this;$.isEmptyObject(t.doc)||$.each(t.doc,function(t,o){e.isFunc(o)&&$.e.doc[t].push(o)}),$.isEmptyObject(t.win)||$.each(t.win,function(t,o){e.isFunc(o)&&$.e.win[t].push(o)})},type:function(t){var e="";switch(typeof t){case"function":e="function";break;case"object":e=$.isArray(t)?"array":t instanceof jQuery?"jquery":"object";break;case"string":e="string";break;case"number":e=isNaN(t)?"string":"number";break;case"":case"undefined":e="undefined";break;default:e="undefined";break}return e},isFunc:function(t){if("function"==typeof t)return!0}};e.waitForIt(),$.waitForIt={html:"<div class='waitForIt' style='position:absolute;z-index:8000;' />",close:function(){$(document).find(".waitForIt").fadeOut(function(){$(this).parent().hasClass("saveCart")&&$(this).parent().removeAttr("style"),$(this).remove()})},me:function(t,e){$(".waitForIt").length<=0&&(e?t.css({position:"relative"}).append(this.html):t.append(this.html))}};var o={_active:[],exceptions:{},api:{},doc:{ready:function(){if($("[data-popit]").popit(),sessionStorage.getItem("popit")&&($.popit._.info=$.parseJSON(sessionStorage.getItem("popit")),$.popit.open($.popit._.info.name,{cssClass:"refreshedModal",href:"/browse/templates/bcc.jsp?id="+$.popit._.info.bcc}),sessionStorage.removeItem("popit")),null!==sessionStorage.getItem("sessionTimeout")){var t=sessionStorage.getItem("sessionTimeout");$.popit.alert("sessionTimeout",{data:"<p style='text-align:center;'>Your session expired due to inactivity on "+t+".<br/>To continue click the 'OK' button below.</p>",cssClass:"informationModal",closeBtn:"Ok",modalX:!1,exposeClose:!1,closeBtnFunc:function(){window.location.reload()}}),e.timeout=null,sessionStorage.removeItem("sessionTimeout")}if($("#formHandlerError").length){["cybersourceError","rtgPCIInternalError","addressLookup","invalidItem"].indexOf($("#formHandlerError").val())>-1||$.popit.alert("error",{data:$("#errorMessage").val(),cssClass:"informationModal",closeBtn:"Close",modalX:!1,exposeClose:!1,msgType:$("#formHandlerError").val()})}}},win:{resizestop:function(){$.popit._._active.length>0&&$.each($.popit._._active,function(t){$.popit.center($.popit._._active[t])})}}};t.prototype={init:function(t){var o=this;$.isEmptyObject(t)?e.isFunc($.popit.x[o.defaults.name+"DOMReady"])&&$.popit.x[o.defaults.name+"DOMReady"](o):(e.isFunc($.popit.x[o.defaults.name+"DOMReady"])&&$.popit.x[o.defaults.name+"DOMReady"](o),void 0!==t.opts.info&&void 0!==t.opts.info.$custom&&$.isArray(t.opts.info.$custom)&&$.popit.x.customEvents(t))},fetch:function(t){function o(){if(t.opts.href.match(t.defaults.rxMatch)){var e="";t.opts.href=t.opts.href.replace(t.defaults.rxMatch,"")}}var i=this,a=t.opts.type?t.opts.type:"POST",s=t.opts.dataType?t.opts.dataType:"HTML";if(void 0!==t.opts._linkswitch&&o(),e.isFunc($.popit.x[t.defaults.name+"BeforeSend"])&&$.popit.x[t.defaults.name+"BeforeSend"](t),!0===t.opts.cache&&void 0!==t.data)i.create(t,t.data);else{var p={};$.each(t.opts,function(t,o){"function"!==e.type(t)&&"function"!==e.type(o)&&(p[t]=o)}),$.ajax({type:a,url:t.opts.href,data:t.opts.form||p,dataType:s,beforeSend:function(){e.isFunc(t.opts.before)&&t.opts.before()},success:function(o){var a=e.detect(o,[{name:"form",sel:"form"},{name:"iframe",sel:"iframe"},{name:"modal",sel:"[data-popit]"}]);if(t[a.name]=a.$el,t.successMsg=$(o).find(".successResponse").length>0?$(o).find(".successResponse").html():null,t.form){var s=[".required","[data-required]"],p=void 0!==$(o).find("form").attr("id")?$(o).find("form").attr("id"):$(o).find("form").attr("name");t.formId=$("#"+p),t.$required=$(o).find(s.toString())}if(!1!==t.opts.cache&&(t.data=o),e.isFunc(t.opts.insuccess)&&t.opts.insuccess(o),e.isFunc(t.opts.success)&&"success"===o.result)return t.opts.success(),!0;i.create(t,o)},complete:function(){t.modal&&console.log("fetch has modal"),e.isFunc(t.opts.complete)&&t.opts.complete()},error:function(){}})}},create:function(t,o){var i=this;!0===t.opts.dialog&&(o="string"===e.type(o)?o:o.errors||o.formErrors),!0===t.opts.prompt&&(o="string"===e.type(o)?o:o.errors||o.formErrors);var a=t.opts.modalX?"<a role='button' aria-label='Close modal' href='javascript:void(0);' class='close'>&otimes;</a>":"",s=t.opts.closeBtn?"<a class='closeModal redBtn fakeBtn'>"+t.opts.closeBtn+"</a>":"",p=t.opts.target?$(t.opts.target).html():"",n="<div id='"+t.defaults.name+"' class='popup "+t.opts.css+"' style='visibility:hidden;"+t.opts.style+"'>"+a+"<div id='modalData'>"+p+"</div>"+s+"</div>",c=t.opts.structure?"":n;if($.popit._.$wrap.append(c),t.opts.target){var r=e.detect(t.opts.target,[{name:"modal",sel:"[data-popit]"}]);$.isEmptyObject(r.$el)||(t[r.name]=r.$el,$("[data-popit='"+r.$el.attr("data-popit")+"']").popit())}t.opts.expose&&(t.opts.exposeClose&&$("#expose").length<=0&&$.popit._.$wrap.append("<div id='expose'/>"),!t.opts.exposeClose&&$("#expose-"+t.defaults.name).length<=0&&$.popit._.$wrap.append("<div id='expose-"+t.defaults.name+"'/>")),t.$modal=$("#"+t.defaults.name),t.$container=t.$modal.find("#modalData"),o&&t.$container.append(o),t.form&&t.$required.length>0&&e.keyEvents(t,t.$required),i.paint(t)},center:function(t){var e=this,o=$("#"+t.defaults.name),i=o.width(),a=o.height(),s=$(window).width(),p=$(window).height(),n=(p-a)/2,c=(s-i)/2,r="fixed";e.height=a,o.css({position:"fixed",visibility:"visible",top:n,left:c}).animate({opacity:"1"},300)},paint:function(t){var o=this;e.isFunc($.popit.x[t.defaults.name])&&$.popit.x[t.defaults.name](t),e.isFunc(t.opts.closeBtnFunc)&&$(document).on("click","a.closeModal",t.opts.closeBtnFunc),t.opts.dialog&&$.popit.x.dialog(t),t.opts.prompt&&$.popit.x.prompt(t),$.isEmptyObject(t.iframe)||($.waitForIt.me(t.$modal),t.iframe.load(t.iframe.attr("src"),function(){$.waitForIt.close()})),o.center(t),t.form?$(t.formId.selector).find("input[type='text']:visible").first().focus():t.$container.find("h2:visible").first().focus(),e.isFunc(t.opts.runLast)&&t.opts.runLast(t),$.popit._._active.push(t)},thanks:function(t){function e(){t.successMsg.match(t.defaults.rxMatch)&&(t.successMsg=t.successMsg.replace(t.defaults.rxMatch,t.captureValue.val()))}var o=$("#modalData")||t.$container,i=$("#modalWrap .popup")||t.$modal;void 0!==t.captureValue&&e(),o.fadeOut(function(){i.addClass("successMsg").append(t.successMsg)})},aria:function(t){var e="true"===t.attr("aria-hidden")?{"aria-hidden":!1,"aria-expanded":!0}:{"aria-hidden":!0,"aria-expanded":!1};t.attr(e)},alert:function(e,o){var i=this,a={defaults:{name:e},opts:$.extend({},{closeBtn:"Close"},o)};$.popit.close(),$.popit._.api[e]=new t(null,a),$.popit._.api[e].init($.popit._.api[e]),i[void 0!==$.popit._.api[e].opts.href?"fetch":"create"]($.popit._.api[e],$.popit._.api[e].opts.data)},dialog:function(o,i){var a=this,s={defaults:{name:o},opts:$.extend({},{dialog:!0,success:i.success?i.success:null,close:{text:"Close",class:"close",func:function(t,e,o){$.popit.close()}},continue:{text:"Ok",class:"ok",func:function(t,e,o){alert("default")}},run:function(t){var o=e.detect(t,[{name:"modal",sel:"[data-popit]"}]);$.isEmptyObject(o.$el)||$("[data-popit='"+o.$el.attr("data-popit")+"']").popit()}},i)};$.popit.close(),$.popit._.api[o]=new t(null,s),$.popit._.api[o].init($.popit._.api[o]),a[void 0!==$.popit._.api[o].opts.href?"fetch":"create"]($.popit._.api[o],$.popit._.api[o].opts.data)},prompt:function(o,i){var a=this,s={defaults:{name:o},opts:$.extend({},{prompt:!0,success:i.success?i.success:null,input:{id:"idField",class:"classField",name:"nameField",value:"",placeholder:""},close:{text:"Close",class:"close",func:function(t,e,o){$.popit.close()}},continue:{text:"Ok",class:"ok",func:function(t,e,o){alert(t.opts.input.value)}},run:function(t){var o=e.detect(t,[{name:"modal",sel:"[data-popit]"}]);$.isEmptyObject(o.$el)||$("[data-popit='"+o.$el.attr("data-popit")+"']").popit()}},i)};$.popit.close(),$.popit._.api[o]=new t(null,s),$.popit._.api[o].init($.popit._.api[o]),a[void 0!==$.popit._.api[o].opts.href?"fetch":"create"]($.popit._.api[o],$.popit._.api[o].opts.data)},open:function(o,i){var a=this;if("object"===e.type(o))$.popit._.create($.popit._.api[o],i);else{var s={defaults:{name:o},opts:i};$.popit.close(),$.popit._.api[o]=new t(null,s),$.popit._.api[o].init($.popit._.api[o]);a[void 0!==$.popit._.api[o].opts.href?"fetch":"create"]($.popit._.api[o],$.popit._.api[o].opts.data)}},close:function(t,o){var i=this;if($.popit._._active.length<=0)return!0;if(t)try{$.popit._.api[t].$modal.remove()}catch(t){}else if($.popit._._active.length>0){var a=$.popit._._active[$.popit._._active.length-1];try{"false"!==o.aria&&i.aria(a.$el)}catch(t){}try{e.isFunc(a.opts.onClose)&&a.opts.onClose(a)}catch(t){}a.$modal.animate({opacity:"0"},300,function(){a.$modal.remove(),$.popit._._active.pop(),0===$.popit._._active.length&&($.popit._.$wrap.empty(),$.popit._._active=[]),void 0!==a.opts.close&&($(document).off("click",".dialog"+a.opts.close.class+"Btn"),$(document).off("click",".dialog"+a.opts.continue.class+"Btn"))})}}},$.popit={_:o,x:o.exceptions,alert:function(e,o){t.prototype.alert(e,o)},dialog:function(e,o){t.prototype.dialog(e,o)},prompt:function(e,o){t.prototype.prompt(e,o)},open:function(e,o){t.prototype.open(e,o)},close:function(e,o){t.prototype.close(e,o)},center:function(e,o){t.prototype.center(e,o)}},$.fn.popit=function(e){var o=$(this),i={};this.each(function(){i=new t(this,e),i.init(),$(this).data("popit",i),data=$(this).data("info"),$.each(data,function(t,e){"true"===e&&(data[t]=!0),"false"===e&&(data[t]=!1)}),$.popit._.api[i.defaults.name]=$.extend({},$(this).data("popit"),data)}),$("#modalWrap").length<=0&&($("body").append('<div id="modalWrap"/>'),$.popit._.$wrap=$("#modalWrap")),this.close=function(){$.popit.close()},o.off("click").on("click",function(t){var e=$(this),o=e.attr("data-popit"),i=$.popit._.api[o];return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!!$("#"+i.opts.name).length||("true"==i.opts.dialog?($.popit.dialog(i.opts.name,i.opts),!1):"true"==i.opts.prompt?($.popit.prompt(i.opts.name,i.opts),!1):("false"!==i.opts.aria&&i.aria(e),void(void 0!==i.opts.target?i.create(i):i.fetch(i))))}),$.popit._.$wrap.off("click","#expose, a.close, a.closeModal"),$.popit._.$wrap.on("click","#expose, a.close, a.closeModal",this.close),$.popit._.$wrap.off("keydown"),$.popit._.$wrap.on("keydown",function(t){$.popit._._active.length>-1&&27===t.keyCode&&$.popit.close()})},e.checkApiEvents($.popit._),$.popit.x.sessionWarning=function(t){var o={runLast:function(){function t(){clearInterval(e.sessionTime),sessionStorage.setItem("sessionTimeout",(new Date).toLocaleString()),window.location.reload()}var o=$(".countDown"),i=60;e.sessionTime=setInterval(function(){--i,0===i?t(e.sessionTime):o.text(i)},1e3)}};t.opts=$.extend({},t.opts,o)},$.e.doc.ready.push(function(){if(null===e.timeout)return!0;setTimeout(function(){$.popit.alert("sessionWarning",{data:"Your session is about to expire in <span class='countDown' style='font-weight:bold;'>60</span> seconds, to continue please click 'OK' below.",css:"informationModal",closeBtn:"OK",modalX:!1,exposeClose:!1,closeBtnFunc:function(){window.location.reload()}})},1e3*e.timeout)}),$.popit.x.dialog=function(t){e.jsload({url:"static/templates/dialog.htm",target:t.$modal.find("#modalData"),data:t.opts,append:!0,success:t.opts.success,run:t.opts.run}),$.popit._.$wrap.off("click",".dialog"+t.opts.continue.class+"Btn"),$.popit._.$wrap.on("click",".dialog"+t.opts.continue.class+"Btn",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.opts.continue.func(t,$(this),e)}),$.popit._.$wrap.off("click",".dialog"+t.opts.close.class+"Btn"),$.popit._.$wrap.on("click",".dialog"+t.opts.close.class+"Btn",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.opts.close.func(t,$(this),e)})},$.popit.x.prompt=function(t){e.jsload({url:"static/templates/prompt.htm",target:t.$modal.find("#modalData"),data:t.opts,append:!0,success:t.opts.success,run:t.opts.run}),$.popit._.$wrap.off("click",".prompt"+t.opts.continue.class+"Btn"),$.popit._.$wrap.on("click",".prompt"+t.opts.continue.class+"Btn",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.opts.input.value=$("#prompt"+t.opts.input.id+"Txt").val(),t.opts.continue.func(t,$(this),e)}),$.popit._.$wrap.off("click",".prompt"+t.opts.close.class+"Btn"),$.popit._.$wrap.on("click",".prompt"+t.opts.close.class+"Btn",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.opts.close.func(t,$(this),e)})},$.popit.x.customEvents=function(t){for(var e=t.opts.info.$custom,o=0;o<e.length;o++)$(document).on(e[o].event,e[o].$el,e[o].func)};