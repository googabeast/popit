function t(t,e){this.defaults={name:$(t).attr("data-popit"),aria:!0,cache:!0,delay:0,css:"",modalX:!0,expose:!0,exposeClose:!0,rxMatch:/@{(.*?)\}/},null==t?this.opts=$.extend({},this.defaults,e.opts):(this.$el=$(t),this.opts=$.extend({},this.defaults,$(t).data().info,{_linkswitch:$(t).data().linkswitch},e))}var e={_active:[],exceptions:{},api:{},doc:{ready:function(){$("[data-popit]").popit(),sessionStorage.getItem("popit")&&(e.info=$.parseJSON(sessionStorage.getItem("popit")),$.popit.open(e.info.name,{css:"refreshedModal",href:"/browse/templates/bcc.jsp?id="+e.info.bcc}),sessionStorage.removeItem("popit"))}},win:{resizestop:function(){e._active.length>0&&$.each(e._active,function(t){e.center(e._active[t])})}},fetch:function(t){function o(){if(t.opts.href.match(t.defaults.rxMatch)){var e="";e=request.storeCart()?t.opts._linkswitch.storecart:request.payOnline()?t.opts._linkswitch.payonline:t.opts._linkswitch.checkout,t.opts.href=t.opts.href.replace(t.defaults.rxMatch,e)}}if(type=t.opts.type?t.opts.type:"POST",dataType=t.opts.dataType?t.opts.dataType:"HTML",void 0!==t.opts._linkswitch&&o(),"function"==typeof e.exceptions[t.defaults.name+"BeforeSend"]&&e.exceptions[t.defaults.name+"BeforeSend"](t),!0===t.opts.cache&&void 0!==t.data)this.create(t,t.data);else{var a={};$.each(t.opts,function(t,e){"function"!=typeof t&&"function"!=typeof e&&(a[t]=e)}),$.ajax({type:type,url:t.opts.href,data:t.opts.form||a,dataType:t.opts.dataType,beforeSend:function(){"function"==typeof t.opts.before&&t.opts.before()},success:function(o){if("error"===o.result&&""!==o.errors){var a=o.errors.split(",");com.postError(a[1],$("#"+a[0]))}else{if(t.iframe=$(o).find("iframe").length>0,t.form=$(o).find("form").length>0,t.successMsg=$(o).find(".successResponse").length>0?$(o).find(".successResponse").html():null,t.form){var i=["[data-required]","textarea.required"],s=void 0!==$(o).find("form").attr("id")?$(o).find("form").attr("id"):$(o).find("form").attr("name");t.formId=$("#"+s),t.$required=$(o).find(i.toString())}if(!1!==t.opts.cache&&(t.data=o),"function"==typeof t.opts.insuccess&&t.opts.insuccess(o),"function"==typeof t.opts.success&&"success"==o.result)return t.opts.success(),!0;e.create(t,o)}},complete:function(){"function"==typeof t.opts.complete&&t.opts.complete()},error:function(){}})}},create:function(t,e){!0===t.opts.dialog&&(e=e.errors||e.formErrors),modalX=t.opts.modalX?"<a role='button' aria-label='Close modal' href='javascript:void(0);' class='close'></a>":"",closeBtn=t.opts.closeBtn?"<a class='closeModal redBtn fakeBtn'>"+t.opts.closeBtn+"</a>":"",this.$wrap.append("<div id='"+t.defaults.name+"' class='popup "+t.opts.css+"' style='visibility:hidden;"+t.opts.style+"'>"+modalX+"<div id='modalData'></div>"+closeBtn+"</div>"),t.opts.expose&&(t.opts.exposeClose&&$("#expose").length<=0&&this.$wrap.append("<div id='expose'/>"),!t.opts.exposeClose&&$("#expose-"+t.defaults.name).length<=0&&this.$wrap.append("<div id='expose-"+t.defaults.name+"'/>")),t.$modal=$("#"+t.defaults.name),t.$container=t.$modal.find("#modalData"),t.$container.append(e),t.form&&t.$required.length>0&&com.keyEvents(t,t.$required),this.style(t)},center:function(t){var e=$("#"+t.defaults.name),o=e.width(),a=e.height(),i=$(window).width(),s=$(window).height(),n=(s-a)/2,p=(i-o)/2,c="fixed";this.api[t.defaults.name].height=a,e.css({position:"fixed",visibility:"visible",top:n,left:p}).animate({opacity:"1"},300)},style:function(t){"function"==typeof e.exceptions[t.defaults.name]&&e.exceptions[t.defaults.name](t),"function"==typeof t.opts.closeBtnFunc&&$(document).on("click","a.closeModal",t.opts.closeBtnFunc),!0===t.opts.dialog&&e.exceptions.dialog(t),t.iframe&&($.waitForIt.me(t.$modal),this.$wrap.find("iframe").load(function(){$.waitForIt.close()})),this.center(t),t.form?$(t.formId.selector).find("input[type='text']:visible").first().focus():t.$container.find("h2:visible").first().focus(),"function"==typeof t.opts.runLast&&t.opts.runLast(t),e._active.push(t)},thanks:function(t){function e(){t.successMsg.match(t.defaults.rxMatch)&&(t.successMsg=t.successMsg.replace(t.defaults.rxMatch,t.captureValue.val()))}var o=$("#modalData")||t.$container,a=$("#modalWrap .popup")||t.$modal;void 0!==t.captureValue&&e(),o.fadeOut(function(){a.addClass("successMsg").append(t.successMsg)})},aria:function(t){tags="true"==t.attr("aria-hidden")?{"aria-hidden":!1,"aria-expanded":!0}:{"aria-hidden":!0,"aria-expanded":!1},t.attr(tags)}};t.prototype={init:function(t){var o=this;$.isEmptyObject(t)&&"function"==typeof e.exceptions[o.defaults.name+"DOMReady"]&&e.exceptions[o.defaults.name+"DOMReady"](o)},alert:function(o,a){var i=this;theseOpts={defaults:{closeBtn:"Close"}},$.popit.close(),e.api[o]=new t(null,theseOpts),e.api[o].init(e.api[o]),void 0!==e.api[o].opts.href?e.fetch(e.api[o],e.api[o].opts.data):e.create(e.api[o],e.api[o].opts.data)},dialog:function(o,a){var i=this;theseOpts={defaults:{dialog:!0}},$.popit.close(),e.api[o]=new t(null,theseOpts),e.api[o].init(e.api[o]),void 0!==e.api[o].opts.href?e.fetch(e.api[o],e.api[o].opts.data):e.create(e.api[o],e.api[o].opts.data)},open:function(o,a){var i=this;$.popit.close(),"object"==typeof o?e.create(e.api[o],a):(e.api[o]=new t(null),e.api[o].init(e.api[o]),void 0!==e.api[o].opts.href?e.fetch(e.api[o],e.api[o].opts.data):e.create(e.api[o],e.api[o].opts.data),void 0!==e.api[o].opts.info&&void 0!==e.api[o].opts.info.$custom&&"object"==typeof e.api[o].opts.info.$custom&&$.isArray(e.api[o].opts.info.$custom)&&e.exceptions.customEvents(e.api[o]))},close:function(t,o){var a=this;if(t)try{e.api[t].$modal.remove()}catch(t){}else if(e._active.length>0){var i=e._active[e._active.length-1];try{"false"!==o.aria&&e.aria(i.$el)}catch(t){}try{"function"==typeof i.opts.onClose&&i.opts.onClose(i)}catch(t){}i.$modal.animate({opacity:"0"},300,function(){i.$modal.remove(),e._active.pop(),0===e._active.length&&(e.$wrap.empty(),e._active=[])})}else console.log("all active modals are closed")}},$.popit={alert:function(e,o){t.prototype.alert(e,o)},dialog:function(e,o){t.prototype.dialog(e,o)},open:function(e,o){t.prototype.open(e,o)},close:function(e,o){t.prototype.close(e,o)}},$.fn.popit=function(o){var a=$(this),i={};this.each(function(){i=new t(this,o),i.init(),$(this).data("popit",i),e.api[i.defaults.name]=$.extend({},$(this).data("popit"),$(this).data("info"))}),$("#modalWrap").length<=0&&($("body").append('<div id="modalWrap"/>'),e.$wrap=$("#modalWrap")),this.close=function(){$.popit.close()},a.on("click",function(t){var o=$(this),a=o.attr("data-popit"),i=e.api[a];t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),"false"!==i.opts.aria&&e.aria(o),e.fetch(i)}),$(document).on("click","#expose, a.close, a.closeModal",this.close)},com.checkApiEvents(e),e.exceptions.dialog=function(t){com.load("/static/templates/dialog.htm",t.$modal.find("#modalData"),t.opts,!0),$(document).on("click",".dialog"+t.opts.continue.text+"Btn",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.opts.continue.func(t,$(this),e)}),$(document).on("click",".dialog"+t.opts.close.text+"Btn",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.opts.close.func(t,$(this),e)})},e.exceptions.customEvents=function(t){for(var e=t.opts.info.$custom,o=0;o<e.length;o++)$(document).on(e[o].event,e[o].$el,e[o].func)};